<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>TikTok Profile Downloader</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body { font-family: Arial, sans-serif; background: #f5f5f5; margin: 0; padding: 15px; }
.wrapper { max-width: 600px; margin: auto; }

/* PROFILE HEADER */
.profile {
  background: white; border-radius: 12px; padding: 15px;
  display: flex; align-items: center; margin-bottom: 20px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.05);
}
.profile img {
  width: 70px; height: 70px; border-radius: 50%; margin-right: 15px; border: 2px solid #eee;
}
.stats { display: flex; gap: 15px; font-size: 13px; color: #555; margin-top: 5px; }

/* VIDEO GRID */
.grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; }

.card {
  background: white; border-radius: 10px; overflow: hidden;
  box-shadow: 0 2px 8px rgba(0,0,0,0.08); position: relative;
}

/* SKELETON LOADER */
.thumb-placeholder {
  height: 250px; width: 100%;
  background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
  background-size: 200% 100%;
  animation: shimmer 1.5s infinite;
}
@keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }

.card img { display: none; width: 100%; height: 250px; object-fit: cover; }
.info { padding: 10px; }
.status { font-size: 11px; color: #888; margin-bottom: 8px; }

/* BUTTONS */
.btn {
  width: 100%; padding: 10px; border: none; border-radius: 6px;
  background: #000; color: #fff; font-weight: bold; cursor: pointer;
  font-size: 13px;
}
.btn:disabled { background: #ccc; cursor: not-allowed; }

@media(max-width:500px) { .grid { grid-template-columns: 1fr; } }
</style>
</head>
<body>

<div class="wrapper">
  <div id="profileInfo"><h3>Loading Profile...</h3></div>
  <div id="videos" class="grid"></div>
</div>

<script>
async function fetchProfile() {
  const res = await fetch(`/profile?url=${encodeURIComponent(profileUrl)}`);
  const data = await res.json();

  if (data.error) {
    document.getElementById("profileInfo").innerHTML = `<h3>${data.error}</h3>`;
    return;
  }

  renderProfile(data.user);
  queue = data.links; // Array of video URLs
  renderPlaceholders(queue.length);
  processQueue(0);
}

async function processQueue(i) {
  if (i >= queue.length) return;

  const card = document.querySelectorAll(".card")[i];
  const status = card.querySelector(".status");
  const img = card.querySelector("img");
  const thumb = card.querySelector(".thumb");
  const actions = card.querySelector(".actions");

  try {
    const res = await fetch(`/api?url=${encodeURIComponent(queue[i])}`);
    const json = await res.json();
    const videoData = json.data;

    if (videoData) {
      img.src = videoData.cover;
      img.onload = () => {
        thumb.remove();
        img.style.display = "block";
      };
      
      actions.innerHTML = `
        <button class="btn" onclick="download('${videoData.play}','tiktok_${videoData.id}')">Download</button>
      `;
      status.textContent = "Ready";
    } else {
      status.textContent = "Failed to load";
    }
  } catch (e) {
    status.textContent = "Error";
  }

  // 1.2 second delay before processing the next video
  setTimeout(() => processQueue(i + 1), 1200);
}

</script>

</body>
</html>
